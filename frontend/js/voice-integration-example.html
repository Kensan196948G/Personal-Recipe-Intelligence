<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éŸ³å£°ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆçµ±åˆã‚µãƒ³ãƒ—ãƒ« - Personal Recipe Intelligence</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    h1 {
      color: #333;
      margin-bottom: 24px;
      text-align: center;
    }

    .recipe-card {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .recipe-title {
      font-size: 20px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 12px;
    }

    .ingredients-list {
      margin-bottom: 16px;
    }

    .ingredients-list h3 {
      font-size: 16px;
      color: #6c757d;
      margin-bottom: 8px;
    }

    .ingredients-list ul {
      list-style: none;
      padding-left: 0;
    }

    .ingredients-list li {
      padding: 4px 0;
      color: #495057;
    }

    .steps-list {
      margin-bottom: 16px;
    }

    .steps-list h3 {
      font-size: 16px;
      color: #6c757d;
      margin-bottom: 8px;
    }

    .steps-list ol {
      padding-left: 20px;
    }

    .steps-list li {
      padding: 8px 0;
      color: #495057;
      line-height: 1.6;
    }

    .steps-list li.current-step {
      background: #fff3cd;
      padding: 12px;
      margin: 8px -12px;
      border-radius: 6px;
      border-left: 4px solid #ffc107;
    }

    .voice-controls {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .status-display {
      text-align: center;
      margin-bottom: 20px;
    }

    .status-icon {
      font-size: 48px;
      margin-bottom: 8px;
    }

    .status-text {
      font-size: 18px;
      color: #6c757d;
    }

    .transcript-box {
      background: #f8f9fa;
      border: 1px solid #ced4da;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 16px;
      min-height: 60px;
    }

    .transcript-label {
      font-weight: bold;
      color: #495057;
      margin-bottom: 4px;
    }

    .transcript-text {
      color: #212529;
      font-size: 16px;
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    button {
      flex: 1;
      min-width: 150px;
      padding: 12px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .btn-primary {
      background: #28a745;
      color: white;
    }

    .btn-primary:hover {
      background: #218838;
    }

    .btn-primary:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }

    .btn-primary.active {
      background: #dc3545;
      animation: pulse 1.5s infinite;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn-secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .settings-panel {
      background: #f8f9fa;
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .setting-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .setting-row label {
      min-width: 80px;
      font-weight: 500;
      color: #495057;
    }

    .setting-row input[type="range"] {
      flex: 1;
    }

    .setting-row span {
      min-width: 60px;
      text-align: right;
      color: #6c757d;
    }

    .alert {
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 16px;
    }

    .alert-warning {
      background: #fff3cd;
      border: 1px solid #ffc107;
      color: #856404;
    }

    .alert-error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    .alert-info {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>éŸ³å£°ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆçµ±åˆã‚µãƒ³ãƒ—ãƒ«</h1>

    <div id="unsupportedAlert" class="alert alert-warning" style="display: none;">
      ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°æ©Ÿèƒ½ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Chromeã€Edgeã€Safariã®æœ€æ–°ç‰ˆã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚
    </div>

    <div class="recipe-card">
      <div class="recipe-title">ã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹</div>

      <div class="ingredients-list">
        <h3>ææ–™ï¼ˆ4äººåˆ†ï¼‰</h3>
        <ul>
          <li>ç‰ã­ã: 2å€‹</li>
          <li>ã«ã‚“ã˜ã‚“: 1æœ¬</li>
          <li>ã˜ã‚ƒãŒã„ã‚‚: 3å€‹</li>
          <li>è±šè‚‰: 300g</li>
          <li>ã‚«ãƒ¬ãƒ¼ãƒ«ãƒ¼: 1ç®±</li>
        </ul>
      </div>

      <div class="steps-list">
        <h3>ä½œã‚Šæ–¹</h3>
        <ol id="stepsList">
          <li>ç‰ã­ãã€ã«ã‚“ã˜ã‚“ã€ã˜ã‚ƒãŒã„ã‚‚ã‚’ä¸€å£å¤§ã«åˆ‡ã‚Šã¾ã™</li>
          <li>é‹ã«æ²¹ã‚’ç†±ã—ã€è±šè‚‰ã‚’ç‚’ã‚ã¾ã™</li>
          <li>é‡èœã‚’åŠ ãˆã¦ã•ã‚‰ã«ç‚’ã‚ã¾ã™</li>
          <li>æ°´ã‚’åŠ ãˆã¦ç…®è¾¼ã¿ã¾ã™</li>
          <li>ã‚¢ã‚¯ã‚’å–ã‚ŠãªãŒã‚‰20åˆ†ç…®è¾¼ã¿ã¾ã™</li>
          <li>ç«ã‚’æ­¢ã‚ã¦ã‚«ãƒ¬ãƒ¼ãƒ«ãƒ¼ã‚’æº¶ã‹ã—ã¾ã™</li>
          <li>å†ã³ç«ã‚’ã¤ã‘ã¦ã¨ã‚ã¿ãŒã¤ãã¾ã§ç…®è¾¼ã¿ã¾ã™</li>
        </ol>
      </div>
    </div>

    <div class="voice-controls">
      <div class="status-display">
        <div class="status-icon" id="statusIcon">ğŸ¤</div>
        <div class="status-text" id="statusText">éŸ³å£°å…¥åŠ›ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div>
      </div>

      <div id="transcriptBox" class="transcript-box" style="display: none;">
        <div class="transcript-label">èªè­˜çµæœ:</div>
        <div class="transcript-text" id="transcriptText"></div>
      </div>

      <div id="errorBox" class="alert alert-error" style="display: none;"></div>

      <div class="button-group">
        <button id="voiceBtn" class="btn-primary">ğŸ¤ éŸ³å£°å…¥åŠ›é–‹å§‹</button>
        <button id="pauseBtn" class="btn-secondary" disabled>â¸ ä¸€æ™‚åœæ­¢</button>
        <button id="resumeBtn" class="btn-secondary" disabled>â–¶ å†é–‹</button>
        <button id="stopBtn" class="btn-secondary" disabled>â¹ åœæ­¢</button>
      </div>

      <div class="settings-panel">
        <h3 style="margin-bottom: 12px; color: #495057;">éŸ³å£°è¨­å®š</h3>
        <div class="setting-row">
          <label>éŸ³é‡:</label>
          <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="1">
          <span id="volumeValue">100%</span>
        </div>
        <div class="setting-row">
          <label>é€Ÿåº¦:</label>
          <input type="range" id="rateSlider" min="0.5" max="2" step="0.1" value="1">
          <span id="rateValue">1.0x</span>
        </div>
      </div>

      <div class="alert alert-info">
        <strong>åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:</strong><br>
        æ¬¡ã®æ‰‹é †ã€å‰ã®æ‰‹é †ã€ææ–™ã‚’èª­ã‚“ã§ã€ã‚‚ã†ä¸€åº¦ã€æœ€åˆã‹ã‚‰ã€ã‚¿ã‚¤ãƒãƒ¼3åˆ†ã€ãªã©
      </div>
    </div>
  </div>

  <script src="speech-service.js"></script>
  <script src="tts-service.js"></script>
  <script src="voice-command-handler.js"></script>
  <script>
    // ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ã‚·ãƒ”ãƒ‡ãƒ¼ã‚¿
    const sampleRecipe = {
      title: 'ã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹',
      ingredients: [
        { name: 'ç‰ã­ã', amount: '2å€‹' },
        { name: 'ã«ã‚“ã˜ã‚“', amount: '1æœ¬' },
        { name: 'ã˜ã‚ƒãŒã„ã‚‚', amount: '3å€‹' },
        { name: 'è±šè‚‰', amount: '300g' },
        { name: 'ã‚«ãƒ¬ãƒ¼ãƒ«ãƒ¼', amount: '1ç®±' }
      ],
      steps: [
        'ç‰ã­ãã€ã«ã‚“ã˜ã‚“ã€ã˜ã‚ƒãŒã„ã‚‚ã‚’ä¸€å£å¤§ã«åˆ‡ã‚Šã¾ã™',
        'é‹ã«æ²¹ã‚’ç†±ã—ã€è±šè‚‰ã‚’ç‚’ã‚ã¾ã™',
        'é‡èœã‚’åŠ ãˆã¦ã•ã‚‰ã«ç‚’ã‚ã¾ã™',
        'æ°´ã‚’åŠ ãˆã¦ç…®è¾¼ã¿ã¾ã™',
        'ã‚¢ã‚¯ã‚’å–ã‚ŠãªãŒã‚‰20åˆ†ç…®è¾¼ã¿ã¾ã™',
        'ç«ã‚’æ­¢ã‚ã¦ã‚«ãƒ¬ãƒ¼ãƒ«ãƒ¼ã‚’æº¶ã‹ã—ã¾ã™',
        'å†ã³ç«ã‚’ã¤ã‘ã¦ã¨ã‚ã¿ãŒã¤ãã¾ã§ç…®è¾¼ã¿ã¾ã™'
      ]
    };

    // ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–
    const speechService = new SpeechService();
    const ttsService = new TTSService();
    const commandHandler = new VoiceCommandHandler(speechService, ttsService);

    // ãƒ¬ã‚·ãƒ”è¨­å®š
    commandHandler.setRecipe(sampleRecipe);

    // DOM è¦ç´ 
    const voiceBtn = document.getElementById('voiceBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resumeBtn = document.getElementById('resumeBtn');
    const stopBtn = document.getElementById('stopBtn');
    const statusIcon = document.getElementById('statusIcon');
    const statusText = document.getElementById('statusText');
    const transcriptBox = document.getElementById('transcriptBox');
    const transcriptText = document.getElementById('transcriptText');
    const errorBox = document.getElementById('errorBox');
    const unsupportedAlert = document.getElementById('unsupportedAlert');
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeValue = document.getElementById('volumeValue');
    const rateSlider = document.getElementById('rateSlider');
    const rateValue = document.getElementById('rateValue');
    const stepsList = document.getElementById('stepsList');

    // ã‚µãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
    if (!speechService.isSupported() || !ttsService.isSupported()) {
      unsupportedAlert.style.display = 'block';
      voiceBtn.disabled = true;
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    speechService.onStart(() => {
      statusIcon.textContent = 'ğŸ”´';
      statusText.textContent = 'éŸ³å£°èªè­˜ä¸­...';
      voiceBtn.textContent = 'ğŸ”´ èªè­˜ä¸­';
      voiceBtn.classList.add('active');
    });

    speechService.onEnd(() => {
      statusIcon.textContent = 'ğŸ¤';
      statusText.textContent = 'éŸ³å£°å…¥åŠ›ã‚’é–‹å§‹ã—ã¦ãã ã•ã„';
      voiceBtn.textContent = 'ğŸ¤ éŸ³å£°å…¥åŠ›é–‹å§‹';
      voiceBtn.classList.remove('active');
    });

    speechService.onError((error) => {
      errorBox.textContent = error.message;
      errorBox.style.display = 'block';
      setTimeout(() => {
        errorBox.style.display = 'none';
      }, 3000);
    });

    speechService.onResult((results) => {
      const finalResults = results.filter(r => r.isFinal);
      const interimResults = results.filter(r => !r.isFinal);

      if (finalResults.length > 0) {
        const text = finalResults[0].transcript;
        transcriptText.textContent = text;
        transcriptBox.style.display = 'block';
        commandHandler.executeCommand(text);
      } else if (interimResults.length > 0) {
        transcriptText.textContent = interimResults[0].transcript + ' (èªè­˜ä¸­...)';
        transcriptBox.style.display = 'block';
      }
    });

    ttsService.onStart(() => {
      statusIcon.textContent = 'ğŸ”Š';
      statusText.textContent = 'èª­ã¿ä¸Šã’ä¸­...';
      pauseBtn.disabled = false;
      stopBtn.disabled = false;
    });

    ttsService.onEnd(() => {
      statusIcon.textContent = 'ğŸ¤';
      statusText.textContent = 'éŸ³å£°å…¥åŠ›ã‚’é–‹å§‹ã—ã¦ãã ã•ã„';
      pauseBtn.disabled = true;
      resumeBtn.disabled = true;
      stopBtn.disabled = true;
    });

    // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
    voiceBtn.addEventListener('click', () => {
      if (speechService.getListeningStatus()) {
        speechService.stop();
      } else {
        speechService.start();
      }
    });

    pauseBtn.addEventListener('click', () => {
      ttsService.pause();
      pauseBtn.disabled = true;
      resumeBtn.disabled = false;
    });

    resumeBtn.addEventListener('click', () => {
      ttsService.resume();
      pauseBtn.disabled = false;
      resumeBtn.disabled = true;
    });

    stopBtn.addEventListener('click', () => {
      ttsService.cancel();
    });

    // éŸ³é‡å¤‰æ›´
    volumeSlider.addEventListener('input', (e) => {
      const volume = parseFloat(e.target.value);
      ttsService.setVolume(volume);
      volumeValue.textContent = Math.round(volume * 100) + '%';
    });

    // é€Ÿåº¦å¤‰æ›´
    rateSlider.addEventListener('input', (e) => {
      const rate = parseFloat(e.target.value);
      ttsService.setRate(rate);
      rateValue.textContent = rate.toFixed(1) + 'x';
    });

    // æ‰‹é †å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
    window.addEventListener('voiceStepChange', (event) => {
      const stepIndex = event.detail.stepIndex;

      // ã™ã¹ã¦ã®æ‰‹é †ã‹ã‚‰ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤
      const allSteps = stepsList.querySelectorAll('li');
      allSteps.forEach(step => step.classList.remove('current-step'));

      // ç¾åœ¨ã®æ‰‹é †ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
      if (allSteps[stepIndex]) {
        allSteps[stepIndex].classList.add('current-step');
        allSteps[stepIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    });

    // ã‚¿ã‚¤ãƒãƒ¼çµ‚äº†ã‚¤ãƒ™ãƒ³ãƒˆ
    window.addEventListener('voiceTimerEnd', () => {
      alert('ã‚¿ã‚¤ãƒãƒ¼ãŒçµ‚äº†ã—ã¾ã—ãŸï¼');
    });
  </script>
</body>
</html>
